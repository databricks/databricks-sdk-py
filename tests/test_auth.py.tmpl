# These are auto-generated tests for Unified Authentication
# In case of editing this file, make sure the change is propagated to all Databricks SDK codebases

import functools
import os

import pytest

from databricks.sdk.core import Config

__tests__ = os.path.dirname(__file__)


def raises(msg):
    def inner(func):
        @functools.wraps(func)
        def wrapper(*args, **kwargs):
            with pytest.raises(DatabricksError) as info:
                func(*args, **kwargs)
            exception_str = str(info.value)
            exception_str = exception_str.replace(__tests__ + '/', '')
            assert msg in exception_str
        return wrapper
    return inner


{{range .}}{{- with .AssertError}}@raises("{{.}}"){{end}}
def {{.SnakeName}}({{if .Env}}monkeypatch{{end}}):{{range $k,$v := .Env}}
    monkeypatch.setenv('{{$k}}', {{if eq $k "HOME"}}__tests__ + '/{{$v}}'{{else}}'{{$v}}'{{end}}){{end}}
    cfg = Config({{range $i,$v := .Fields}}{{if $i}}, {{end}}{{.Key}}='{{.Value}}'{{end}})
    {{with .AssertAuth}}
    assert cfg.auth_type == '{{.}}'{{end}}{{with .AssertHost}}
    assert cfg.host == '{{.}}'{{end}}{{if .AssertAzure}}
    assert cfg.is_azure{{end}}

{{end}}